# Vibe on Rails (VibeOnRails)

## What We're Building
A full-stack TypeScript framework designed for AI-assisted development. Predictable conventions, SKILL.md in every folder, zero ambiguity for humans and AI.

## Tech Stack
- **Language**: TypeScript (strict mode)
- **Monorepo**: Turborepo with pnpm workspaces
- **HTTP Server**: Hono (fast, edge-ready)
- **API Layer**: tRPC (end-to-end type safety)
- **Database**: Drizzle ORM (type-safe SQL)
- **Validation**: Zod (schema validation)
- **Auth**: jose (JWT) + Argon2 (password hashing)
- **Queue**: BullMQ (Redis-based)
- **Email**: Resend
- **Testing**: Vitest
- **Package Manager**: pnpm

## Project Structure
```
packages/
├── core/                  # API (Hono + tRPC), Database (Drizzle + repos + seeds), Security (JWT, sessions, OAuth, crypto, CSRF, audit)
├── infra/                 # Health, Logging, Queue/Cron, Email, Cache, Storage, Realtime/WebSocket, Monitoring/Metrics
├── cli/                   # CLI: create projects, generate modules/components, dev/build/db commands
├── web/                   # Frontend: CSS system, React components, hooks, tRPC client, routing
├── docs/                  # Documentation framework: Starlight presets, MDX components, Remark plugins
├── features/
│   ├── payments/          # Stripe: checkout, subscriptions, customer, webhooks
│   ├── admin/             # Admin panel: auto-generated CRUD views
│   ├── support/           # Helpdesk: tickets, knowledge base, chat
│   ├── sales/             # AI sales agent: channels (webchat, whatsapp, telegram)
│   └── marketing/         # Marketing automation: content, social, email sequences
templates/
├── app/                   # App template (scaffolded by create-vibe)
│   ├── src/web/           # Frontend pages (Home, Login, Register, Dashboard, Posts)
│   └── content/           # Email templates, website copy, brand guidelines
├── module/                # Module template (generated by vibe generate module)
└── component/             # Component template (generated by vibe generate component)
docs/                      # Documentation site (uses @vibeonrails/docs, dogfooded)
examples/
├── basic/                 # Minimal example (auth + posts)
└── saas/                  # Full SaaS example (all features)
```

## Commands
```bash
pnpm install          # Install dependencies
pnpm run dev          # Start dev server
pnpm run test         # Run tests
pnpm run typecheck    # Type check
pnpm run lint         # Lint
pnpm run build        # Build all packages
pnpm run validate     # Full check: typecheck + lint + test + build + git add
```

## Code Style
- TypeScript strict mode, no `any` (use `unknown` if needed)
- Functions under 50 lines, single responsibility
- Conventional commits: `feat:`, `fix:`, `docs:`, `test:`, `refactor:`
- Colocated tests: `feature.test.ts` next to `feature.ts`
- Barrel exports: every module has `index.ts`

## Architecture Rules
- Each package has a SKILL.md that teaches AI agents how to use it
- Packages export via barrel pattern: `@vibeonrails/core/api`, `@vibeonrails/core/database`
- All user input validated with Zod schemas
- Use tRPC procedures: `publicProcedure`, `protectedProcedure`
- Database queries use Drizzle ORM, no raw SQL unless necessary
- Error handling: throw `AppError` subclasses (`NotFoundError`, `ValidationError`)

## Testing Rules
- Tests first (TDD): write failing test, then implement
- Fix the implementation, never the test (unless test is wrong)
- Colocate tests: `feature.test.ts` next to `feature.ts`
- Use Vitest for all testing

## CLI Commands
- `vibe create <name>` — Scaffold new project
- `vibe generate module <name>` — Generate a module
- `vibe generate component <name>` — Generate a React component
- `vibe dev` — Start dev server
- `vibe db migrate|seed|reset|studio` — Database operations
- `vibe build` — Production build
- `vibe docs init|dev|build` — Documentation site management

## Current Status
All 16 projects are complete (Project 16: Mobile is deferred).

- ✅ @vibeonrails/core: API, Database (repos, seeds), Security (JWT, sessions, OAuth, crypto, CSRF, audit)
- ✅ @vibeonrails/infra: Health, Logging, Queue/Cron, Email, Cache, Storage, Realtime, Monitoring
- ✅ @vibeonrails/cli: create, generate module/component, dev, db, build, docs commands
- ✅ @vibeonrails/web: CSS system, React components, hooks, routing
- ✅ @vibeonrails/docs: Starlight presets, MDX components (ApiReference, CodeExample, PackageInstall, PropTable, StatusBadge), Remark plugins (skill-loader, api-gen), docs site template
- ✅ @vibeonrails/payments: Stripe checkout, subscriptions, webhooks
- ✅ @vibeonrails/admin: Auto-generated CRUD admin panel
- ✅ @vibeonrails/support: Tickets, knowledge base, chat
- ✅ @vibeonrails/sales: AI sales agent, multi-channel
- ✅ @vibeonrails/marketing: Content generation, social scheduling, email sequences
- ✅ App Template: Backend + frontend pages + content system
- ✅ Module Template + Component Template
- ✅ Documentation site: 179 pages (Astro Starlight, Diataxis framework, dogfooded @vibeonrails/docs)
- ✅ Example applications (basic + SaaS)

## Important Notes
- Don't add dependencies without discussing (keep the stack minimal)
- Every package must have a SKILL.md that explains its purpose and usage
- Follow "Convention over Configuration" philosophy
- All code must be AI-agent-friendly (clear patterns, predictable structure)
