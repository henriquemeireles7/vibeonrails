# Vibe on Rails - Cursor Rules

## Project: VibeonRails

A full-stack TypeScript framework for AI-assisted development. Convention over configuration, SKILL.md in every folder, zero ambiguity for humans and AI.

## Tech Stack

- Language: TypeScript (strict mode)
- Monorepo: Turborepo + pnpm workspaces
- HTTP Server: Hono (fast, edge-ready)
- API Layer: tRPC (end-to-end type safety)
- Database: Drizzle ORM (type-safe SQL)
- Validation: Zod (schema validation)
- Auth: jose (JWT) + Argon2 (password hashing)
- Queue: BullMQ (Redis-based)
- Email: Resend
- Testing: Vitest
- Docs: Astro Starlight

## Development Workflow

1. Plan first - Break down features into steps before coding
2. TDD - Write tests first (RED), implement (GREEN), refactor (IMPROVE)
3. Review - Check code quality and security after changes
4. Commit - Use conventional commits (feat:, fix:, refactor:, etc.)

## Code Style

- TypeScript strict mode always
- No `any` type - use `unknown` for external data
- Small files (200-400 lines max)
- Small functions (<50 lines)
- Immutability preferred (const, spread, map)
- No emojis in code or comments
- No console.log in production code

## Naming Conventions

- Variables/Functions: camelCase
- Classes/Types: PascalCase
- Constants: UPPER_SNAKE_CASE
- Files: kebab-case
- Directories: kebab-case

## Security (MANDATORY)

Before any commit:
- No hardcoded secrets (API keys, passwords, tokens)
- All user inputs validated with Zod
- SQL injection prevention (use Drizzle ORM)
- XSS prevention (sanitized HTML)
- Error messages don't leak sensitive data

## Testing Requirements

- Minimum 80% test coverage
- Unit tests for all functions
- Integration tests for API endpoints
- Colocated tests: feature.test.ts next to feature.ts
- Always fix implementation, not tests (unless tests are wrong)

## Git Workflow

- Conventional commits: feat:, fix:, refactor:, docs:, test:, chore:
- Branch naming: feat/description, fix/description, refactor/description

## Key Commands

```bash
pnpm install        # Install dependencies
pnpm run dev        # Start dev server
pnpm run test       # Run tests
pnpm run typecheck  # Type check
pnpm run lint       # Lint
pnpm run build      # Build all packages
pnpm run validate   # Full check: typecheck + lint + test + build + git add
```

## Architecture Rules

- Each package has a SKILL.md explaining its purpose and usage
- Packages export via barrel pattern: @vibeonrails/core/api, @vibeonrails/core/database
- All user input validated with Zod schemas
- Use tRPC procedures: publicProcedure, protectedProcedure
- Database queries use Drizzle ORM, no raw SQL
- Error handling: throw AppError subclasses (NotFoundError, ValidationError)
